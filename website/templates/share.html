{% extends "_base.html" %}

{% load static %}

{% block main %}
  <main class="w-100 mw9 outline mb0 ma1 pa1 center flex-grow flex flex-column justify-center">
    <form action="" method="post" class="flex flex-column w-100 mw7 center">
      {% csrf_token %}
    
      {% for error in form.non_field_errors %}
        <span class="w-100 f6 red b">{{ error }}</span>
      {% endfor %}
    
      <div class="flex flex-row flex-wrap justify-center justify-between-l items-center mh2 mv4">
        <label for="{{ form.message.id_for_label }}" class="w-100 mb1">{{ form.message.label }}</label>
        <div id="text-container" class="w-100 w-90-l flex flex-row flex-wrap">
          <textarea id="{{ form.message.id_for_label }}" name="{{ form.message.html_name }}"
                  rows="5" cols="10" placeholder="{{ form.message.help_text }}"
                  class="w-100" maxlength="500" required>{{ form.message.value | default:'' }}</textarea>
          {% for error in form.message.errors %}
            <span class="w-100 f6 red b">{{ error }}</span>
          {% endfor %}
        </div>
        
        <div class="w-10-l pa1 flex flex-row justify-center">
          <a id="record-button" type="button" 
             class="link flex flex-column items-center justify-center w3 h3 white br4 bg-dark-gray">
            <i data-feather="mic" class="w2 h2"></i>
          </a>
          <a id="stop-button" type="button" 
             class="link dn flex-column items-center justify-center w3 h3 white br4 bg-red">
            <i data-feather="circle" class="w2 h2"></i>
          </a>
        </div>
      </div>
    
      <fieldset class="flex flex-wrap mv4">
        <legend>Coordinate GPS</legend>
        <div class="pa1 w-50-ns">
          <label for="{{ form.latitude.id_for_label }}">{{ form.latitude.label }}</label>
          <input id="{{ form.latitude.id_for_label }}" name="{{ form.latitude.html_name }}"
                 type=number step="any" class="w-100" required readonly>
          {% for error in form.latitude.errors %}
            <span class="w-100 f6 red b">{{ error }}</span>
          {% endfor %}
        </div>
        <div class="pa1 w-50-ns">
          <label for="{{ form.longitude.id_for_label }}">{{ form.longitude.label }}</label>
          <input id="{{ form.longitude.id_for_label }}" name="{{ form.longitude.html_name }}"
                 type=number step="any" class="w-100" required readonly>
          {% for error in form.longitude.errors %}
            <span class="w-100 f6 red b">{{ error }}</span>
          {% endfor %}
        </div>
        
        <div class="w-100 pa1 tc">
          <button id="location-button" type="button" onclick="readCurrentPosition()">
            Inserisci posizione
          </button>  
        </div>
      </fieldset>
      
      <div class="center pa2">
        <input id="button-submit" type="submit" value="Partecipa!" disabled>
      </div>
    </form>
  </main>
{% endblock %}


{% block scripts %}
  
  <script src="https://unpkg.com/feather-icons" defer></script>
  <script defer>
    document.addEventListener('DOMContentLoaded', () => feather.replace());
  </script>

  
  <script src="https://unpkg.com/axios/dist/axios.min.js" defer></script>
  
  <script defer>
    function readCurrentPosition() {
      if (!navigator.geolocation) { 
        showErrorAlert("Geolocation is not supported by this browser."); 
        return;
      }
      
      navigator.geolocation.getCurrentPosition(
          position => {
            $("input#{{ form.latitude.id_for_label }}").val(position.coords.latitude);
            $("input#{{ form.longitude.id_for_label }}").val(position.coords.longitude);
            $("input#button-submit").removeAttr("disabled");
          }, 
          error => showErrorAlert(error.message)
      );
    }
  </script>
  
  <!-- recommended -->
  <script src="https://www.WebRTC-Experiment.com/RecordRTC.js" defer></script>
  <script src="{% static 'website/js/record.js' %}" defer></script>
  
{% endblock %}